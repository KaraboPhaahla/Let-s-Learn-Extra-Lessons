<!DOCTYPE html>
<html lang="en">
<head>

   <!-- Add this in your <head> --> 
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
	
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Let's Learn Portal</title>
  <style>
    :root {
      --bg: #0a0a0a;
      --surface: #111317;
      --card: #141821;
      --white: #ffffff;
      --muted: #cfd3d8;
      --gold: #d4af37;
      --gold-2: #f2d16b;
      --accent: #ffd966;
      --error: #ff5c7a;
      --success: #48d597;
      --shadow-1: rgba(0,0,0,0.3);
      --shadow-2: rgba(212,175,55,0.35);
      --radius: 16px;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      color: var(--white);
      background:
        radial-gradient(1200px 600px at 10% -20%, rgba(212,175,55,0.12), transparent 40%),
        radial-gradient(900px 500px at 90% 120%, rgba(242,209,107,0.08), transparent 40%),
        linear-gradient(180deg, #090b10 0%, #0b0e14 60%, #0a0a0a 100%);
      min-height: 100vh;
    }

    /* Header with subtle 3D */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(20,24,33,0.85) 0%, rgba(20,24,33,0.65) 100%);
      border-bottom: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 8px 24px var(--shadow-1);
    }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 18px 0;
    }
    .logo {
  width: 42px;
  height: 42px;
  border-radius: 10px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;

  /* 3D gold frame */
  background: linear-gradient(135deg, var(--gold) 0%, var(--gold-2) 100%);
  box-shadow: 0 10px 30px rgba(212,175,55,0.35),
              inset 0 2px 8px rgba(255,255,255,0.3);
  border: 1px solid rgba(255,255,255,0.22);
}

.logo img {
  width: 100%;
  height: 100%;
  object-fit: cover;   /* ensures your picture fills the space */
  border-radius: 8px;  /* matches the rounded corners */
}


.logo:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 14px 36px rgba(212,175,55,0.45);
  transition: all 0.25s ease;
}
    .title {
      font-weight: 700; letter-spacing: 0.3px;
      background: linear-gradient(90deg, #fff, var(--muted));
      background-clip: text; -webkit-background-clip: text; color: transparent;
    }
    .subtitle { color: var(--muted); font-size: 14px; margin-top: 2px; }

    /* Nav tabs */
    nav {
      display: flex; gap: 8px; flex-wrap: wrap;
      padding-bottom: 14px;
    }
    .tab-btn {
      position: relative;
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.08);
      color: var(--muted);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.15);
      cursor: pointer;
      transition: transform 200ms ease, box-shadow 200ms ease, color 200ms ease, border-color 200ms ease;
    }
    .tab-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 16px rgba(0,0,0,0.25);
      color: #fff;
      border-color: rgba(255,255,255,0.18);
    }
    .tab-btn.active {
      color: #0b0e14;
      font-weight: 600;
      background: linear-gradient(135deg, var(--gold), var(--gold-2));
      border: 1px solid rgba(255,255,255,0.35);
      box-shadow: 0 12px 26px var(--shadow-2);
    }

    /* Main sections */
    main { padding: 24px 0 56px; }
    section.card {
      display: none;
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: var(--radius);
      box-shadow: 0 16px 40px var(--shadow-1), inset 0 1px 0 rgba(255,255,255,0.12);
      padding: 22px;
      margin-bottom: 22px;
    }
    section.card.active { display: block; }

    h2 {
      margin: 0 0 14px;
      font-weight: 700;
      letter-spacing: 0.2px;
      background: linear-gradient(90deg, #fff, var(--muted));
      background-clip: text; -webkit-background-clip: text; color: transparent;
    }
    p.lead { color: var(--muted); margin-top: 6px; }

    /* Grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 16px;
    }
    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 12px 26px rgba(0,0,0,0.25);
      transition: transform 200ms ease, box-shadow 200ms ease, border-color 200ms ease;
    }
    .panel:hover {
      transform: translateY(-3px);
      box-shadow: 0 16px 36px rgba(212,175,55,0.2);
      border-color: rgba(212,175,55,0.35);
    }
    .panel h3 {
      margin: 0 0 8px;
      font-weight: 600;
      color: #fff;
    }
    .chips {
      display: flex; flex-wrap: wrap; gap: 8px;
    }
    .chip {
      padding: 6px 10px;
      border-radius: 20px;
      font-size: 13px;
      color: #0b0e14;
      background: linear-gradient(135deg, var(--gold), var(--accent));
      border: 1px solid rgba(255,255,255,0.35);
      box-shadow: 0 8px 16px var(--shadow-2);
    }

    /* Forms */
    form {
      display: grid; gap: 12px; max-width: 720px;
    }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { font-size: 13px; color: var(--muted); }
    input, select, textarea {
      width: 100%; padding: 12px 12px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      color: #fff; outline: none;
      transition: border-color 150ms ease, box-shadow 150ms ease;
    }
    input:focus, select:focus, textarea:focus {
      border-color: rgba(212,175,55,0.55);
      box-shadow: 0 0 0 3px rgba(212,175,55,0.25);
    }
    textarea { min-height: 110px; resize: vertical; }

    .btn {
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      padding: 12px 16px; border-radius: 12px; cursor: pointer; border: none;
      color: #0b0e14; font-weight: 600;
      background: linear-gradient(135deg, var(--gold), var(--gold-2));
      border: 1px solid rgba(255,255,255,0.45);
      box-shadow: 0 14px 30px var(--shadow-2);
      transition: transform 180ms ease, box-shadow 180ms ease, filter 180ms ease;
    }
    .btn:hover { transform: translateY(-2px); filter: brightness(1.03); }
    .btn.secondary {
      color: #fff;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 10px 24px rgba(0,0,0,0.22);
    }

    .note { font-size: 13px; color: var(--muted); }

    /* Status */
    .status {
      padding: 10px 12px; border-radius: 10px; font-size: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
    }
    .status.ok { border-color: rgba(72,213,151,0.45); color: #b2f3d8; }
    .status.err { border-color: rgba(255,92,122,0.45); color: #ffc8d2; }

    /* Online class embed box */
    .class-box {
      display: grid; gap: 16px;
    }
    .iframe-wrap {
      border-radius: 14px; overflow: hidden;
      border: 1px solid rgba(255,255,255,0.12);
      background: #0c0f15;
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
      min-height: 320px;
    }
    .iframe-wrap iframe {
      width: 100%; height: 360px; border: 0;
    }

    footer {
      padding: 22px 0; color: var(--muted);
      border-top: 1px solid rgba(255,255,255,0.08);
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    }
	
	/* submission button */

	
	#assessments .btn {
  background: linear-gradient(135deg, var(--gold), var(--gold-2));
  box-shadow: 0 12px 28px rgba(212,175,55,0.35);
}
#assessments input[type="file"] {
  padding: 12px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.12);
  background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
  color: #fff;
}

  </style>
  
  
  <style>
  
     /* Brand tokens */
:root {
  --gold-100: #fff7d6;   /* light highlight */
  --gold-200: #ffe083;
  --gold-300: #ffd54f;   /* bright gold */
  --gold-400: #f9a825;   /* rich gold */
  --gold-500: #c99700;   /* deep gold for shadow */
  --white:    #ffffff;
  --ink:      #1a1a1a;
}

/* Container nav (optional) */
.navbar {
  display: flex;
  gap: 0.75rem;
  align-items: center;
}

/* Logout button */
.logout-btn {
  --height: 44px;
  --pad-x: 18px;
  --radius: 999px;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: var(--height);
  padding: 0 var(--pad-x);
  border-radius: var(--radius);

  color: var(--ink);
  font-weight: 700;
  letter-spacing: 0.2px;

  /* Gold gradient body */
  background: linear-gradient(180deg, var(--gold-300) 0%, var(--gold-400) 65%, var(--gold-500) 100%);
  border: 1px solid rgba(201, 151, 0, 0.7);

  /* 3D depth via layered shadows */
  box-shadow:
    0 10px 18px rgba(201, 151, 0, 0.35),    /* outer soft gold shadow */
    inset 0 1px 0 var(--gold-100),          /* top highlight */
    inset 0 -2px 4px rgba(0,0,0,0.15);      /* inner bottom depth */

  /* Subtle gloss highlight */
  position: relative;
  overflow: hidden;
}

/* Shine sweep */
.logout-btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -120%;
  width: 60%;
  height: 100%;
  background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.25) 50%, transparent 100%);
  transform: skewX(-18deg);
  pointer-events: none;
  animation: sweep 4.5s ease-in-out infinite;
}

@keyframes sweep {
  0%   { left: -120%; }
  55%  { left: 140%; }
  100% { left: 140%; }
}

/* Hover: lift and glow */
.logout-btn:hover {
  box-shadow:
    0 14px 24px rgba(201, 151, 0, 0.42),
    inset 0 1px 0 var(--gold-100),
    inset 0 -2px 4px rgba(0,0,0,0.15);
  transform: translateY(-1px);
}

/* Active: press in */
.logout-btn:active {
  transform: translateY(1px);
  box-shadow:
    0 8px 14px rgba(201, 151, 0, 0.32),
    inset 0 2px 5px rgba(0,0,0,0.22);
}

/* Keyboard accessibility */
.logout-btn:focus-visible {
  outline: 3px solid #ffe083;
  outline-offset: 3px;
}

/* Optional icon spacing */
.logout-btn .icon {
  width: 18px;
  height: 18px;
  margin-right: 8px;
  display: inline-block;
}

/* Dark navbar background contrast (optional) */
.navbar--dark {
  background: linear-gradient(180deg, #0e0e0e 0%, #1a1a1a 100%);
  padding: 10px 14px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

/* Assessment tab disabled state (pairs with your login gating) */
.tab {
  color: var(--white);
  padding: 8px 12px;
  border-radius: 10px;
}

.tab--disabled {
  opacity: 0.55;
  cursor: not-allowed;
  filter: grayscale(25%);
  position: relative;
}

.tab--disabled::after {
  content: "Login required";
  position: absolute;
  top: 100%;
  left: 0;
  font-size: 12px;
  color: var(--gold-200);
  margin-top: 4px;
}

  
  </style>
  
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <div class="logo">
           <img src="LLLogo.jpeg" alt="Logo" />
        </div>
        <div>
          <div class="title">Let's Learn Portal</div>
          <div class="subtitle">Virtual classes, Grades 4‚Äì12, secure student access</div>
        </div>
      </div>

      <nav id="tabs">
        <button class="tab-btn active" data-tab="home">Home</button>
        <button class="tab-btn" data-tab="grades">Grades</button>
        <button class="tab-btn" data-tab="online">Online class</button>
        <button class="tab-btn" data-tab="signup">Sign up</button>
        <button class="tab-btn" data-tab="login">Login</button>
		<button id="adminTabBtn" class="tab-btn" data-tab="admin">Admin</button>
        <button class="tab-btn" data-tab="booking">Parent booking</button>
		<button class="tab-btn" data-tab="assessments" id="assessmentTab">Assessments</button>
		<button id="logoutBtn" class="tab-btn" style="display:none;">Logout</button>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- Home -->
    <section id="home" class="card active">
      <h2>Welcome</h2>
      <p class="lead">Join live classes, explore grade-specific subjects, and manage your student access with a unique ID. Parents can register children without signing in.</p>

      <div class="grid">
        <div class="panel">
          <h3>How access works</h3>
          <p class="note">Only students registered to the program can sign up or log in using their unique Student ID. Parents submit bookings; once approved, the student receives an ID for access.</p>
        </div>
        <div class="panel">
          <h3>What‚Äôs included</h3>
          <div class="chips">
            <span class="chip">Live online classes</span>
            <span class="chip">Grades 4‚Äì12</span>
            <span class="chip">Focused subjects</span>
            <span class="chip">Secure login</span>
            <span class="chip">Parent booking</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Grades -->
    <section id="grades" class="card">
      <h2>Grades and subjects</h2>
      <p class="lead">Browse subjects for each grade. Choose your level and see what‚Äôs offered.</p>
      <div id="gradeGrid" class="grid"></div>
    </section>

    <!-- Online Class -->
    <section id="online" class="card">
      <h2>Online class</h2>
      <p class="lead">Join the virtual classroom. Users must be logged in to access session links.</p>

      <div class="class-box">
        <div class="status" id="classStatus">Not logged in. Please log in to join a class.</div>

        <div class="iframe-wrap" id="classEmbed" style="display:none;">
          <!-- Replace src with your meeting provider URL (e.g., Jitsi/Zoom web client) -->
          <iframe 
		  id="classFrame" src="https://meet.jit.si/LetsLearnMathClass" title="Virtual Class"
		   allow="camera; microphone; fullscreen; display-capture; autoplay"
		  ></iframe>
        </div>
		
		
		<!-- Admin / Teacher class controls -->
         <div id="adminClassControls" style="display:none;">
         <label>Grade</label>
<select id="adminGrade">
  <option value="4">Grade 4</option>
  <option value="5">Grade 5</option>
  <option value="6">Grade 6</option>
  <option value="7">Grade 7</option>
  <option value="8">Grade 8</option>
  <option value="9">Grade 9</option>
  <option value="10">Grade 10</option>
  <option value="11">Grade 11</option>
  <option value="12">Grade 12</option>
</select>

<label>Subject</label>
<input id="adminSubject" type="text" placeholder="Mathematics" />

<label>Class room name</label>
<input id="classRoomName" type="text" placeholder="LetsLearn-G10-Maths" />

        <button class="btn secondary" id="postClassBtn">
         Post class link
        </button>
		
		<!-- Admin Dashboard -->
<div id="adminDashboard" style="display:none; margin-top:20px;">
  <h3>üìã Live Classes Dashboard</h3>
  <div id="adminClassList" class="grid"></div>
</div>

		
</div>

		

        <div>
          <button class="btn" id="joinClassBtn">Join a class</button>
          <button class="btn secondary" id="leaveClassBtn">Leave class</button>
        </div>

        <p class="note">Tip: You can host directly via embeddable providers (e.g., Jitsi meet) or link to your live session page.</p>
      </div>
    </section>

    <!-- Sign up (students with valid ID only) -->
    <section id="signup" class="card">
      <h2>Student sign up</h2>
      <p class="lead">Only students with a valid Student ID can create an account.</p>

      <form id="signupForm">
        <div class="row">
          <div>
            <label for="suStudentId">Student ID</label>
            <input id="suStudentId" type="text" placeholder="e.g., EL-2026-0042" required />
          </div>
          <div>
            <label for="suGrade">Grade</label>
            <select id="suGrade" required></select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="suName">Full name</label>
            <input id="suName" type="text" placeholder="Student full name" required />
          </div>
          <div>
            <label for="suEmail">Email</label>
            <input id="suEmail" type="email" placeholder="student@example.com" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="suPassword">Password</label>
            <input id="suPassword" type="password" placeholder="Create a strong password" required />
          </div>
          <div>
            <label for="suConfirm">Confirm password</label>
            <input id="suConfirm" type="password" placeholder="Re-enter password" required />
          </div>
        </div>

        <button class="btn" type="submit">Create account</button>
        <div id="signupStatus" class="status" style="display:none;"></div>
      </form>

      <p class="note">Don‚Äôt have a Student ID yet? Ask your parent/guardian to submit a booking in the Parent booking tab.</p>
    </section>

    <!-- Login (students only) -->
    <section id="login" class="card">
      <h2>Student login</h2>
      <p class="lead">Log in with your registered email, password, and Student ID.</p>

      <form id="loginForm">
        <div class="row">
          <div>
            <label for="liStudentId">Student ID</label>
            <input id="liStudentId" type="text" placeholder="Your Student ID" required />
          </div>
          <div>
            <label for="liEmail">Email</label>
            <input id="liEmail" type="email" placeholder="student@example.com" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="liPassword">Password</label>
            <input id="liPassword" type="password" placeholder="Your password" required />
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn" type="submit">Login</button>
          </div>
        </div>

        <div id="loginStatus" class="status" style="display:none;"></div>
      </form>
	  
    </section>
	
	<!-- Admin Login -->
<section id="admin" class="card">
  <h2>Admin Login</h2>
  <p class="lead">Admins and teachers log in here.</p>

  <form id="adminLoginForm">
    <div class="row">
      <div>
        <label for="adminEmail">Email</label>
        <input id="adminEmail" type="email" placeholder="admin@letslearn.co.za" required />
      </div>
      <div>
        <label for="adminPassword">Password</label>
        <input id="adminPassword" type="password" placeholder="Admin password" required />
      </div>
    </div>

    <button class="btn" type="submit">Login as Admin</button>
    <div id="adminLoginStatus" class="status" style="display:none;"></div>
  </form>
</section>

    <!-- Parent booking (no sign-in) -->
    <section id="booking" class="card">
      <h2>Parent booking</h2>
      <p class="lead">Register your child for the program. No sign-in required.</p>

      <form id="bookingForm">
        <div class="row">
          <div>
            <label for="bkParentName">Parent/Guardian name</label>
            <input id="bkParentName" name="parent_name" type="text" placeholder="Full name" required />
          </div>
          <div>
            <label for="bkParentEmail">Parent email</label>
            <input id="bkParentEmail" name="parent_email" type="email" placeholder="parent@example.com" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="bkChildName">Child full name</label>
            <input id="bkChildName" name="child_name" type="text" placeholder="Student full name" required />
          </div>
          <div>
            <label for="bkChildGrade">Child grade</label>
            <select id="bkChildGrade"  name="child_grade" required></select>
          </div>
        </div>

        <div>
          <label for="bkSubjects">Preferred subjects</label>
          <textarea id="bkSubjects" name="subjects" placeholder="e.g., Mathematics, English, Natural Sciences" required></textarea>
        </div>

        <div class="row">
          <div>
            <label for="bkPhone">Parent phone</label>
            <input id="bkPhone" name="parent_phone" type="tel" placeholder="+27 ..." required />
          </div>
          <div>
            <label for="bkNotes">Notes (optional)</label>
            <input id="bkNotes" name="notes" type="text" placeholder="Any additional info"/>
          </div>
        </div>

        <button class="btn" type="submit">Submit booking</button>
        <div id="bookingStatus" class="status" style="display:none;"></div>
      </form>

      <p class="note">After approval, you‚Äôll receive a unique Student ID for your child. Use that ID to sign up and log in.</p>
    </section>
	
	 <!-- Assessment Submission (only visible when logged in) -->
<section id="assessments" class="card">
  <h2>Submit Assessment</h2>
  <p class="lead">Upload your assignment file. Submissions are emailed directly to the program admin.</p>

  <form id="assessmentForm">
    <div class="row">
	
      <div>
        <label for="asTitle">Student Name/Assessment Title/Student Id</label>
        <input id="asTitle" name="student_name" type="text" placeholder="e.g., Lerato Phala/Mathematics/ EL-2026-0001 " required />
      </div>
      <div>
        <label for="asSubject">Subject</label>
        <input id="asSubject" name="subject_name" type="text" placeholder="e.g., Mathematics" required />
      </div>
    </div>

    <div>
      <label for="asFile">Upload file</label>
      <input type="file" id="asFile"  name="file" accept="application/pdf" required />
    </div>
	
	<div>
	  <input type="hidden" name="student_name" />
	</div>  
	<div>
      <input type="hidden" name="student_id" />
	</div>   
	<div>
      <input type="hidden" name="student_email" />
    </div>

    <button class="btn" type="submit">Submit Assessment</button>
    <div id="assessmentStatus" class="status" style="display:none;"></div>
  </form>
  
</section>
	
  </main>

  <footer>
    <div class="wrap">
      <small>¬© 2026 Let's Learn Portal</small>
    </div>
  </footer>
  
   <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
  // Initialize EmailJS with your user ID
  (function(){
    emailjs.init("dyz2izWtI_dqpIIgC"); 
  })();

  const assessmentForm = document.getElementById("assessmentForm");
  const assessmentStatus = document.getElementById("assessmentStatus");
  
  
  assessmentForm.addEventListener("submit", function (e) {
  e.preventDefault();

  const session = store.getSession();
  if (!session) {
    showStatus(assessmentStatus, "You must be logged in to submit assessments.", false);
    return;
  }

  // Inject session values into hidden fields
  assessmentForm.querySelector('[name="student_name"]').value = session.name;
  assessmentForm.querySelector('[name="student_id"]').value = session.studentId;
  assessmentForm.querySelector('[name="student_email"]').value = session.email;

  emailjs
    .sendForm(
      "service_ckst0wu",
      "template_82btthc",
      assessmentForm
    )
    .then(() => {
      showStatus(assessmentStatus, "Assessment submitted successfully.", true);
      assessmentForm.reset();
    })
    .catch((err) => {
      console.error(err);
      showStatus(assessmentStatus, "Error submitting assessment. Try again.", false);
    });
});

</script>
  
  
  <script>
  
  // ---------- Student SignUP ----------
       async function studentSignup(email, password, grade, name) {
  const { auth, createUserWithEmailAndPassword } = window.authAPI;

  const cred = await createUserWithEmailAndPassword(auth, email, password);

  await window.dbAPI.addDoc(
    window.dbAPI.collection(window.dbAPI.db, "students"),
    {
      uid: cred.user.uid,
      email,
      grade,
      name
    }
  );
}
  
  
// ---------- Student Login ----------  

async function studentLogin(email, password) {
  const { auth, signInWithEmailAndPassword } = window.authAPI;
  await signInWithEmailAndPassword(auth, email, password);
}


window.authAPI.onAuthStateChanged(window.authAPI.auth, async user => {
  if (!user) {
    updateAuthUI(null);
    return;
  }

  const q = window.dbAPI.query(
    window.dbAPI.collection(window.dbAPI.db, "students"),
    window.dbAPI.where("uid", "==", user.uid)
  );

  const snap = await window.dbAPI.getDocs(q);

  if (!snap.empty) {
    const student = snap.docs[0].data();
    store.setSession({
      role: "student",
      name: student.name,
      grade: student.grade
    });
    updateAuthUI(store.getSession());
  }
});

async function logoutUser() {
  await window.authAPI.signOut(window.authAPI.auth);
  store.clearSession();
  location.reload();
}

  
  </script>
  

  <script>
  
  let adminDashboardListener = null;

  
    // ---------- Data: Grades & Subjects ----------
    const subjectsByGrade = {
      4: ["Mathematics", "English", "Home Language", "Natural Sciences", "Social Sciences"],
      5: ["Mathematics", "English", "Home Language", "Natural Sciences", "Social Sciences"],
      6: ["Mathematics", "English", "Home Language", "Natural Sciences", "Social Sciences"],
      7: ["Mathematics", "English", "Home Language", "Natural Sciences", "Social Sciences", "Technology"],
      8: ["Mathematics", "English", "Home Language", "Natural Sciences", "Social Sciences", "Technology"],
      9: ["Mathematics", "English", "Home Language", "Natural Sciences", "Social Sciences", "Technology"],
      10: ["Mathematics/Math Lit", "English", "Home Language", "Physical Sciences", "Life Sciences", "Accounting", "Business Studies", "Economics", "Geography", "History", "IT"],
      11: ["Mathematics/Math Lit", "English", "Home Language", "Physical Sciences", "Life Sciences", "Accounting", "Business Studies", "Economics", "Geography", "History", "IT"],
      12: ["Mathematics/Math Lit", "English", "Home Language", "Physical Sciences", "Life Sciences", "Accounting", "Business Studies", "Economics", "Geography", "History", "IT"]
    };

    // ---------- Simulated registry: only IDs listed can sign up ----------
    // In production, this comes from your backend after parent booking approval.
    const approvedStudentIDs = new Set([
      "EL-2026-0001",
      "EL-2026-0042",
      "EL-2026-1010"
    ]);

    // ---------- LocalStorage helpers ----------
    const LS_KEYS = {
      students: "el_students",
      bookings: "el_bookings",
      session: "el_session"
    };

    const store = {
      getStudents() {
        return JSON.parse(localStorage.getItem(LS_KEYS.students) || "[]");
      },
      saveStudents(students) {
        localStorage.setItem(LS_KEYS.students, JSON.stringify(students));
      },
      getBookings() {
        return JSON.parse(localStorage.getItem(LS_KEYS.bookings) || "[]");
      },
      saveBookings(bookings) {
        localStorage.setItem(LS_KEYS.bookings, JSON.stringify(bookings));
      },
      getSession() {
        return JSON.parse(localStorage.getItem(LS_KEYS.session) || "null");
      },
      saveSession(session) {
        localStorage.setItem(LS_KEYS.session, JSON.stringify(session));
      },
      clearSession() {
        localStorage.removeItem(LS_KEYS.session);
      }
    };

    // ---------- Tabs ----------
    const tabButtons = Array.from(document.querySelectorAll(".tab-btn"));
    const sections = {
  home: document.getElementById("home"),
  grades: document.getElementById("grades"),
  online: document.getElementById("online"),
  signup: document.getElementById("signup"),
  login: document.getElementById("login"),
  admin: document.getElementById("admin"), // ‚úÖ ADD THIS
  booking: document.getElementById("booking"),
  assessments: document.getElementById("assessments")
};


    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        tabButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        Object.values(sections).forEach(sec => sec.classList.remove("active"));
        sections[btn.dataset.tab].classList.add("active");
        
if (btn.dataset.tab === "online") {
  updateOnlineClassUI();
  updateAdminControls();
  listenForStudentClasses(); // ‚úÖ THIS IS THE KEY
}
      });
    });

    // ---------- Populate Grades ----------
    function populateGrades() {
      const gradeGrid = document.getElementById("gradeGrid");
      gradeGrid.innerHTML = "";
      for (let g = 4; g <= 12; g++) {
        const panel = document.createElement("div");
        panel.className = "panel";
        const h = document.createElement("h3");
        h.textContent = `Grade ${g}`;
        const list = document.createElement("div");
        list.className = "chips";
        subjectsByGrade[g].forEach(s => {
          const chip = document.createElement("span");
          chip.className = "chip";
          chip.textContent = s;
          list.appendChild(chip);
        });
        panel.appendChild(h);
        panel.appendChild(list);
        gradeGrid.appendChild(panel);
      }
    }

    function populateGradeSelects() {
      const suGrade = document.getElementById("suGrade");
      const bkChildGrade = document.getElementById("bkChildGrade");
      [suGrade, bkChildGrade].forEach(sel => {
        sel.innerHTML = "";
        for (let g = 4; g <= 12; g++) {
          const opt = document.createElement("option");
          opt.value = g;
          opt.textContent = `Grade ${g}`;
          sel.appendChild(opt);
        }
      });
    }

    // ---------- Sign up ----------
    const signupForm = document.getElementById("signupForm");
    const signupStatus = document.getElementById("signupStatus");

    signupForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const id = document.getElementById("suStudentId").value.trim();
      const grade = parseInt(document.getElementById("suGrade").value, 10);
      const name = document.getElementById("suName").value.trim();
      const email = document.getElementById("suEmail").value.trim().toLowerCase();
      const pw = document.getElementById("suPassword").value;
      const confirm = document.getElementById("suConfirm").value;

      // Validate ID eligibility
      if (!approvedStudentIDs.has(id)) {
        showStatus(signupStatus, "Invalid or unapproved Student ID. Please confirm with the program admin.", false);
        return;
      }
      // Validate password match
      if (pw.length < 6) {
        showStatus(signupStatus, "Password must be at least 6 characters.", false);
        return;
      }
      if (pw !== confirm) {
        showStatus(signupStatus, "Passwords do not match.", false);
        return;
      }

      let students = store.getStudents();
      if (students.find(s => s.studentId === id)) {
        showStatus(signupStatus, "An account with this Student ID already exists.", false);
        return;
      }
      if (students.find(s => s.email === email)) {
        showStatus(signupStatus, "An account with this email already exists.", false);
        return;
      }

      const student = {
        studentId: id,
        grade,
        name,
        email,
        passwordHash: hashPw(pw), // simple demo hash
        createdAt: new Date().toISOString()
      };
      students.push(student);
      store.saveStudents(students);

      showStatus(signupStatus, "Account created successfully. You can now log in.", true);
      signupForm.reset();
    });

    // Simple demo password ‚Äúhash‚Äù
    function hashPw(pw) {
      let h = 0;
      for (let i = 0; i < pw.length; i++) {
        h = ((h << 5) - h) + pw.charCodeAt(i);
        h |= 0;
      }
      return String(h);
    }

    // ---------- Login ----------
    const loginForm = document.getElementById("loginForm");
    const loginStatus = document.getElementById("loginStatus");

    loginForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const id = document.getElementById("liStudentId").value.trim();
      const email = document.getElementById("liEmail").value.trim().toLowerCase();
      const pw = document.getElementById("liPassword").value;

      const students = store.getStudents();
      const student = students.find(s => s.studentId === id && s.email === email);
      if (!student) {
        showStatus(loginStatus, "No account found for this ID and email.", false);
        return;
      }
      if (student.passwordHash !== hashPw(pw)) {
        showStatus(loginStatus, "Incorrect password.", false);
        return;
      }

   
      store.saveSession({
  studentId: student.studentId,
  name: student.name,
  grade: student.grade,
  email: student.email,
  role: "student"
});
      showStatus(loginStatus, `Logged in as ${student.name} (Grade ${student.grade}).`, true);
      updateOnlineClassUI();
    });
	
	// ---------- Admin login (no sign-in) ----------
	
	const adminLoginForm = document.getElementById("adminLoginForm");
const adminLoginStatus = document.getElementById("adminLoginStatus");

// Simple admin credentials (demo)
const ADMIN_CREDENTIALS = {
  email: "admin@letslearn.co.za",
  passwordHash: hashPw("Admin@123")
};

adminLoginForm.addEventListener("submit", (e) => {
  e.preventDefault();

  const email = document.getElementById("adminEmail").value.trim().toLowerCase();
  const pw = document.getElementById("adminPassword").value;

  if (
    email !== ADMIN_CREDENTIALS.email ||
    hashPw(pw) !== ADMIN_CREDENTIALS.passwordHash
  ) {
    showStatus(adminLoginStatus, "Invalid admin credentials.", false);
    return;
  }

  store.saveSession({
  name: "System Admin",
  email,
  role: "admin",
  grade: "admin"
});


  showStatus(adminLoginStatus, "Admin logged in successfully.", true);
  updateAdminControls();
  updateOnlineClassUI();
  updateAuthUI();
  
  // Switch to Online tab so admin UI becomes visible
document.querySelector('[data-tab="online"]').click();
});

    // ---------- Parent booking (no sign-in) ----------
    const bookingForm = document.getElementById("bookingForm");
    const bookingStatus = document.getElementById("bookingStatus");

   bookingForm.addEventListener("submit", function (e) {
  e.preventDefault();

  const parentName = document.getElementById("bkParentName").value.trim();
  const parentEmail = document.getElementById("bkParentEmail").value.trim().toLowerCase();
  const childName = document.getElementById("bkChildName").value.trim();
  const childGrade = document.getElementById("bkChildGrade").value;
  const subjects = document.getElementById("bkSubjects").value.trim();
  const phone = document.getElementById("bkPhone").value.trim();
  const notes = document.getElementById("bkNotes").value.trim();

  const ref = `BK-${Date.now()}`;

  /** ---------- LOCAL STORAGE (keep your logic) ---------- **/
  const bookings = store.getBookings();
  bookings.push({
    ref,
    parentName,
    parentEmail,
    childName,
    childGrade,
    subjects,
    phone,
    notes,
    status: "pending",
    createdAt: new Date().toISOString()
  });
  store.saveBookings(bookings);

  /** ---------- EMAILJS SEND ---------- **/
  const templateParams = {
    parent_name: parentName,
    parent_email: parentEmail,
    parent_phone: phone,
    child_name: childName,
    child_grade: `Grade ${childGrade}`,
    subjects: subjects,
    notes: notes || "None",
    booking_ref: ref
  };

  emailjs
    .sendForm(
      "service_ckst0wu",          // SAME service as assessments
      "template_auvwfdd",  // üëà YOUR NEW TEMPLATE ID
      bookingForm
    )
    .then(() => {
      showStatus(
        bookingStatus,
        `Booking submitted successfully. Reference: ${ref}. We‚Äôll contact you soon.`,
        true
      );
      bookingForm.reset();
    })
    .catch((error) => {
      console.error(error);
      showStatus(
        bookingStatus,
        "Booking saved, but email delivery failed. Please contact support.",
        false
      );
    });
});

	

    // ---------- Online class access ----------
    const classStatus = document.getElementById("classStatus");
    const classEmbed = document.getElementById("classEmbed");
    const classFrame = document.getElementById("classFrame");
    const joinClassBtn = document.getElementById("joinClassBtn");
    const leaveClassBtn = document.getElementById("leaveClassBtn");

    function updateOnlineClassUI() {
  const session = store.getSession();

  if (!session) {
    classStatus.textContent = "Not logged in. Please log in to join a class.";
    classStatus.className = "status err";
    classEmbed.style.display = "none";
    return;
  }

  classStatus.textContent =
    `Logged in as ${session.name} (Grade ${session.grade}). Click Join to enter a live class.`;

  classStatus.className = "status ok";
}


let studentClassListener = null;

function listenForStudentClasses() {
  const session = store.getSession();
  if (!session || session.role !== "student") return;

  const { db, collection, query, where, onSnapshot } = window.dbAPI;

  // üî• Clear old listener
  if (studentClassListener) {
    studentClassListener();
    studentClassListener = null;
  }

  const q = query(
    collection(db, "live_classes"),
    where("grade", "==", session.grade)
  );

  studentClassListener = onSnapshot(q, snap => {
    if (snap.empty) {
      classStatus.textContent = "No live class available for your grade.";
      classStatus.className = "status err";
      classEmbed.style.display = "none";
      return;
    }

    const data = snap.docs[0].data();

    classStatus.textContent = "Live class available. Click Join to enter.";
    classStatus.className = "status ok";

    joinClassBtn.onclick = () => {
  classStatus.textContent =
    "Waiting for teacher to start the class...";
  classStatus.className = "status err";

  classFrame.src = data.url;
  classEmbed.style.display = "block";
};

  });
}

    // ---------- Utility ----------
    function showStatus(el, msg, ok = true) {
      el.style.display = "block";
      el.textContent = msg;
      el.className = ok ? "status ok" : "status err";
    }
	
	function renderAdminDashboard() {
  const list = document.getElementById("adminClassList");
  list.innerHTML = "";

  const { db, collection, onSnapshot } = window.dbAPI;

  // üî• Prevent duplicate listeners
  if (adminDashboardListener) {
    adminDashboardListener();
    adminDashboardListener = null;
  }

  adminDashboardListener = onSnapshot(
    collection(db, "live_classes"),
    snap => {
      list.innerHTML = "";

      if (snap.empty) {
        list.innerHTML = "<p class='note'>No active classes.</p>";
        return;
      }

      snap.forEach(d => {
        const c = d.data();

        const card = document.createElement("div");
        card.className = "panel";
        card.innerHTML = `
          <h3>Grade ${c.grade}</h3>
          <p class="note">${c.subject}</p>
          <button class="btn" onclick="window.open('${c.url}', '_blank')">
  Start Class (Host)
</button>
          <button class="btn secondary" onclick="endFirestoreClass('${d.id}')">End</button>
        `;

        list.appendChild(card);
      });
    }
  );
}


async function endFirestoreClass(id) {
  const { db, deleteDoc, doc } = window.dbAPI;
  await deleteDoc(doc(db, "live_classes", id));
  alert("Class ended for all devices.");
}



function adminJoinClass(link) {
  // üîê Admin must open meeting FIRST
  classEmbed.style.display = "block";

  // Force full moderator context
  classFrame.src = `${link}#userInfo.displayName="Teacher"&config.prejoinPageEnabled=false`;

  classStatus.textContent = "You are hosting the class. Students can now join.";
  classStatus.className = "status ok";
}

function adminEndClass(key) {
  if (!confirm("End this class for all students?")) return;

  localStorage.removeItem(key);
  renderAdminDashboard();
  alert("Class ended.");
}


    // ---------- Init ----------
    populateGrades();
    populateGradeSelects();
    updateOnlineClassUI();
  </script>
  
  
  <script>
 
  // Show admin controls (simple demo rule)
function updateAdminControls() {
  const session = store.getSession();
  const adminBox = document.getElementById("adminClassControls");
  const dashboard = document.getElementById("adminDashboard");
  
  if (session && session.role === "admin") {
    adminBox.style.display = "block";
    dashboard.style.display = "block";
    renderAdminDashboard();
  } else {
    adminBox.style.display = "none";
    dashboard.style.display = "none";
  }
}


  // Student joins class
  


  // Cleanup
  leaveClassBtn.addEventListener("click", () => {
    classFrame.src = "about:blank";
    classEmbed.style.display = "none";
  });

  updateAdminControls();
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    deleteDoc,
    doc,
    onSnapshot,
    query,
    where
  } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBQEb16ttlBkXCFjpFEBWugh4D2ZkCCrog",
    authDomain: "let-s-learn-portal.firebaseapp.com",
    projectId: "let-s-learn-portal"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Expose API
window.dbAPI = {
  db, collection, addDoc, deleteDoc, doc, onSnapshot, query, where
};

// üî• Signal that Firebase is ready
window.firebaseReady = true;

import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

const auth = getAuth(app);


window.authAPI = {
  auth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
};

  // ‚úÖ POST CLASS BUTTON ‚Äî SAFE NOW

</script>  
  
  <script>
  const logoutBtn = document.getElementById("logoutBtn");
  const assessmentTab = document.getElementById("assessmentTab");

  function updateAuthUI() {
    const session = store.getSession();
    const adminTabBtn = document.getElementById("adminTabBtn");
	
	 if (!session) {
    // Logged out
    adminTabBtn.style.display = "inline-block";
  } else if (session.role === "admin") {
    // Admin logged in
    adminTabBtn.style.display = "inline-block";
  } else {
    // Student logged in
    adminTabBtn.style.display = "none";
  }

  // keep the rest of your existing logic below
	
    // Logout button visibility
    logoutBtn.style.display = session ? "inline-flex" : "none";

    // Assessments access
    if (!session) {
      assessmentTab.classList.add("tab--disabled");
      assessmentTab.onclick = (e) => {
        e.preventDefault();
        alert("You must be logged in to access assessments.");
      };

      // Hide assessments section if open
      sections.assessments.classList.remove("active");
    } else {
      assessmentTab.classList.remove("tab--disabled");
      assessmentTab.onclick = null;
    }
  }

  // Logout logic
  logoutBtn.addEventListener("click", () => {
    store.clearSession();
    localStorage.removeItem("isLoggedIn");

    // Reset UI
    tabButtons.forEach(b => b.classList.remove("active"));
    tabButtons[0].classList.add("active"); // Home
    Object.values(sections).forEach(sec => sec.classList.remove("active"));
    sections.home.classList.add("active");

    updateOnlineClassUI();
    updateAuthUI();

    alert("You have been logged out.");
  });

  // Hook into login success
  const originalLoginHandler = loginForm.onsubmit;
  loginForm.addEventListener("submit", () => {
    setTimeout(() => {
      localStorage.setItem("isLoggedIn", "true");
      updateAuthUI();
    }, 100);
  });

  // Init on page load
  updateAuthUI();
</script>

<script>

window.addEventListener("DOMContentLoaded", () => {
  updateAuthUI();
  updateAdminControls();
  updateOnlineClassUI();
});


</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const postClassBtn = document.getElementById("postClassBtn");

  if (!postClassBtn) {
    console.error("Post Class button not found");
    return;
  }

  postClassBtn.addEventListener("click", async () => {
    if (!window.firebaseReady || !window.dbAPI) {
      alert("Firebase not ready yet. Please try again.");
      return;
    }

    const session = store.getSession();
    if (!session || session.role !== "admin") {
      alert("Admins only.");
      return;
    }

    const grade = Number(document.getElementById("adminGrade").value);

    const subject = document
      .getElementById("adminSubject")
      .value.trim()
      .toLowerCase();
    const room = document.getElementById("classRoomName").value.trim();

    if (!grade || !subject || !room) {
      alert("Fill in all fields.");
      return;
    }

    const jitsiUrl = `https://meet.jit.si/${encodeURIComponent(room)}`;

    try {
      await window.dbAPI.addDoc(
        window.dbAPI.collection(window.dbAPI.db, "live_classes"),
        {
          grade,
          subject,
          url: jitsiUrl,
          createdAt: Date.now()
        }
      );

      alert(`Class posted for Grade ${grade} ‚Äì ${subject}`);
      document.getElementById("classRoomName").value = "";
    } catch (err) {
      console.error(err);
      alert("Failed to post class.");
    }
  });
});
</script>

 
</body>
</html>





